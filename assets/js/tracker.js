window.WpStatisticsEngagementTracker||(window.WpStatisticsEngagementTracker={isVisible:"visible"===document.visibilityState,isFocused:document.hasFocus(),isEngaged:!1,engagementStart:0,engagementTotal:0,lastActivityTime:Date.now(),activityTimeout:3e4,init:function(t={}){return t.activityTimeout&&(this.activityTimeout=t.activityTimeout),this.isVisible="visible"===document.visibilityState,this.isFocused=document.hasFocus(),this.lastActivityTime=Date.now(),this.bindEvents(),this.updateEngagementState(),this},bindEvents:function(){const t=this;document.addEventListener("visibilitychange",function(){t.isVisible="visible"===document.visibilityState,t.updateEngagementState()}),window.addEventListener("focus",function(){t.isFocused=!0,t.updateEngagementState()}),window.addEventListener("blur",function(){t.isFocused=!1,t.updateEngagementState()}),window.addEventListener("pagehide",function(){t.stopEngagement()}),["click","scroll","keypress","mousemove","touchstart"].forEach(function(e){document.addEventListener(e,function(){t.recordActivity()},{passive:!0})})},recordActivity:function(){this.lastActivityTime=Date.now(),!this.isEngaged&&this.isVisible&&this.isFocused&&this.updateEngagementState()},isUserActive:function(){return Date.now()-this.lastActivityTime<this.activityTimeout},updateEngagementState:function(){const t=this.isVisible&&this.isFocused&&this.isUserActive();t&&!this.isEngaged?this.startEngagement():!t&&this.isEngaged&&this.stopEngagement()},startEngagement:function(){this.isEngaged||(this.isEngaged=!0,this.engagementStart=Date.now())},stopEngagement:function(){this.isEngaged&&(this.engagementStart>0&&(this.engagementTotal+=Date.now()-this.engagementStart),this.isEngaged=!1,this.engagementStart=0)},getTotalEngagementTime:function(){return this.isEngaged&&this.engagementStart>0?this.engagementTotal+(Date.now()-this.engagementStart):this.engagementTotal},reset:function(){this.stopEngagement(),this.engagementTotal=0,this.lastActivityTime=Date.now(),this.updateEngagementState()},resetAfterFlush:function(){this.engagementTotal=0,this.isEngaged&&(this.engagementStart=Date.now())}}),window.WpStatisticsBatchQueue||(window.WpStatisticsBatchQueue={queue:[],maxQueueSize:10,flushInterval:3e4,maxPayloadSize:63e3,flushIntervalId:null,isInitialized:!1,lastFlushTime:0,lastSentEngagementTime:0,minFlushInterval:3e3,ajaxUrl:null,getSessionData:null,init:function(t={}){return this.isInitialized||(t.maxQueueSize&&(this.maxQueueSize=t.maxQueueSize),t.flushInterval&&(this.flushInterval=t.flushInterval),t.ajaxUrl&&(this.ajaxUrl=t.ajaxUrl),t.getSessionData&&(this.getSessionData=t.getSessionData),this.bindExitEvents(),this.isInitialized=!0),this},add:function(t,e){const i={type:t,data:e,timestamp:Date.now(),url:window.location.href};this.queue.push(i),this.queue.length>=this.maxQueueSize&&this.flush("queue_full")},flush:function(t="manual"){const e=(this.getSessionData?this.getSessionData():{}).engagement_time||0,i=this.queue.length>0,n=Date.now();if(0===e&&!i)return;if(n-this.lastFlushTime<this.minFlushInterval&&!i)return;const s=this.queue.slice();this.queue=[];const a={engagement_time:e,events:s};this.lastSentEngagementTime=e,this.lastFlushTime=n,window.WpStatisticsEngagementTracker&&window.WpStatisticsEngagementTracker.resetAfterFlush&&window.WpStatisticsEngagementTracker.resetAfterFlush(),this.sendBeacon(a)},sendBeacon:function(t){const e=this.ajaxUrl,i=JSON.stringify(t);if(i.length>this.maxPayloadSize)this.splitAndSend(t);else{if(navigator.sendBeacon){const t=new FormData;if(t.append("action","wp_statistics_batch"),t.append("batch_data",i),navigator.sendBeacon(e,t))return}this.sendFetchKeepalive(e,i)}},sendFetchKeepalive:function(t,e){try{const i=new FormData;i.append("action","wp_statistics_batch"),i.append("batch_data",e),fetch(t,{method:"POST",body:i,keepalive:!0}).catch(function(t){})}catch(i){}},splitAndSend:function(t){const e=t.events||[],i=Math.ceil(e.length/2);for(let n=0;n<e.length;n+=i){const s=e.slice(n,n+i),a={engagement_time:0===n?t.engagement_time:0,events:s};this.sendBeacon(a)}},startPeriodicFlush:function(){const t=this;this.stopPeriodicFlush(),this.flushIntervalId=setInterval(function(){t.queue.length>0&&t.flush("periodic")},this.flushInterval)},stopPeriodicFlush:function(){this.flushIntervalId&&(clearInterval(this.flushIntervalId),this.flushIntervalId=null)},bindExitEvents:function(){const t=this;document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&t.flush("visibility_hidden")}),window.addEventListener("pagehide",function(){t.flush("pagehide")})},getStats:function(){return{queueSize:this.queue.length,lastFlushTime:this.lastFlushTime,timeSinceLastFlush:Date.now()-this.lastFlushTime}},clear:function(){this.queue=[],this.lastSentEngagementTime=0},destroy:function(){this.flush("destroy"),this.stopPeriodicFlush(),this.isInitialized=!1}}),window.WpStatisticsUserTracker||(window.WpStatisticsUserTracker={userOnlineIntervalId:null,lastUrl:window.location.href,originalPushState:history.pushState,originalReplaceState:history.replaceState,checkTime:WP_Statistics_Tracker_Object.jsCheckTime,isDndActive:parseInt(navigator.msDoNotTrack||window.doNotTrack||navigator.doNotTrack,10),hasTrackerInitializedOnce:!1,hitRequestSuccessful:!0,useEngagementTracking:!0,init:function(){this.hasTrackerInitializedOnce||(this.hasTrackerInitializedOnce=!0,WP_Statistics_Tracker_Object.option.isPreview||("undefined"==typeof WP_Statistics_Tracker_Object?console.error("WP Statistics: Variable WP_Statistics_Tracker_Object not found. Ensure /wp-content/plugins/wp-statistics/public/frontend/js/tracker.js is either excluded from cache settings or not dequeued by any plugin. Clear your cache if necessary."):(this.checkHitRequestConditions(),WP_Statistics_Tracker_Object.option.userOnline&&this.keepUserOnline()),this.trackUrlChange()))},initEngagementTracking:function(){window.WpStatisticsBatchQueue&&WpStatisticsBatchQueue.init({ajaxUrl:WP_Statistics_Tracker_Object.ajaxUrl,maxQueueSize:10,flushInterval:3e4,getSessionData:function(){return{engagement_time:window.WpStatisticsEngagementTracker?WpStatisticsEngagementTracker.getTotalEngagementTime():0}}}),window.WpStatisticsEngagementTracker&&WpStatisticsEngagementTracker.init({activityTimeout:3e4})},getCommonParams:function(){return{...WP_Statistics_Tracker_Object.onlineParams,signature:WP_Statistics_Tracker_Object.hitParams?.signature,referred:this.getReferred(),page_uri:this.getPathAndQueryString()}},base64Encode:function(t){const e=(new TextEncoder).encode(t);return btoa(String.fromCharCode.apply(null,e))},getPathAndQueryString:function(){const t=window.location.pathname+window.location.search;return this.base64Encode(t)},getReferred:function(){return this.base64Encode(document.referrer)},checkHitRequestConditions:function(){WP_Statistics_Tracker_Object.option.dntEnabled?1!==this.isDndActive?this.sendHitRequest():console.log("WP Statistics: Do Not Track (DNT) is enabled. Hit request not sent."):this.sendHitRequest()},sendHitRequest:async function(){try{let t=this.getRequestUrl("hit");const e={timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,language:navigator.language||navigator.userLanguage,screenWidth:window.screen.width,screenHeight:window.screen.height},i=navigator.language.split("-")[0];e.languageFullName=new Intl.DisplayNames(["en"],{type:"language"}).of(i);const n=new URLSearchParams({...WP_Statistics_Tracker_Object.hitParams,resourceUriId:WP_Statistics_Tracker_Object?.resourceUriId,referred:this.getReferred(),page_uri:this.getPathAndQueryString(),timezone:e.timezone,language:e.language,languageFullName:e.languageFullName,screenWidth:e.screenWidth,screenHeight:e.screenHeight}).toString(),s=new XMLHttpRequest;s.open("POST",t,!0),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.send(n),s.onreadystatechange=function(){4===s.readyState&&(200===s.status?(this.hitRequestSuccessful=!1!==JSON.parse(s.responseText).status,this.hitRequestSuccessful&&this.initEngagementTracking()):(this.hitRequestSuccessful=!1,console.warn("WP Statistics: Hit request failed with status "+s.status)))}.bind(this)}catch(t){this.hitRequestSuccessful=!1,console.error("WP Statistics: Error sending hit request:",t)}},sendOnlineUserRequest:async function(){if(this.hitRequestSuccessful)try{let t=this.getRequestUrl("online");const e=new URLSearchParams({...WP_Statistics_Tracker_Object.onlineParams,referred:this.getReferred(),page_uri:this.getPathAndQueryString()}).toString(),i=new XMLHttpRequest;i.open("POST",t,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send(e)}catch(t){console.error("WP Statistics: Error sending online user request:",t)}},keepUserOnline:function(){let t;WP_Statistics_Tracker_Object.option.userOnline&&(null!==this.userOnlineIntervalId&&(clearInterval(this.userOnlineIntervalId),this.userOnlineIntervalId=null),this.userOnlineIntervalId=setInterval(function(){(!WP_Statistics_Tracker_Object.option.dntEnabled||WP_Statistics_Tracker_Object.option.dntEnabled&&1!==this.isDndActive)&&this.hitRequestSuccessful&&this.sendOnlineUserRequest()}.bind(this),this.checkTime),["click","keypress","scroll","DOMContentLoaded"].forEach(e=>{window.addEventListener(e,()=>{clearTimeout(t),t=setTimeout(()=>{null!==this.userOnlineIntervalId&&(clearInterval(this.userOnlineIntervalId),this.userOnlineIntervalId=null)},18e5)})}))},getRequestUrl:function(t){let e=`${WP_Statistics_Tracker_Object.requestUrl}/`;return WP_Statistics_Tracker_Object.option.bypassAdBlockers?e=WP_Statistics_Tracker_Object.ajaxUrl:"hit"===t?e+=WP_Statistics_Tracker_Object.hitParams.endpoint:"online"===t?e+=WP_Statistics_Tracker_Object.onlineParams.endpoint:"batch"===t&&(e+="batch"),e},updateTrackerObject:function(){const t=document.getElementById("wp-statistics-tracker-js-extra");if(t)try{const e=t.innerHTML.match(/var\s+WP_Statistics_Tracker_Object\s*=\s*(\{[\s\S]*?\});/);e&&e[1]&&(WP_Statistics_Tracker_Object=JSON.parse(e[1]))}catch(e){console.error("WP Statistics: Error parsing WP_Statistics_Tracker_Object",e)}},trackUrlChange:function(){const t=this;window.removeEventListener("popstate",t.handleUrlChange),history.pushState=function(){t.originalPushState.apply(history,arguments),t.handleUrlChange()},history.replaceState=function(){t.originalReplaceState.apply(history,arguments),t.handleUrlChange()},window.addEventListener("popstate",function(){t.handleUrlChange()})},handleUrlChange:function(){window.location.href!==this.lastUrl&&(this.lastUrl=window.location.href,this.updateTrackerObject(),window.WpStatisticsBatchQueue&&WpStatisticsBatchQueue.flush("spa_navigation"),window.WpStatisticsEngagementTracker&&this.useEngagementTracking&&WpStatisticsEngagementTracker.reset(),window.WpStatisticsBatchQueue&&WpStatisticsBatchQueue.clear(),this.hasTrackerInitializedOnce=!1,this.init())}}),window.WpStatisticsEventTracker||(window.WpStatisticsEventTracker={hasEventsInitializedOnce:!1,downloadTracker:!1,linkTracker:!1,init:async function(){this.hasEventsInitializedOnce||WP_Statistics_Tracker_Object.isLegacyEventLoaded||(this.hasEventsInitializedOnce=!0,"undefined"!=typeof WP_Statistics_DataPlus_Event_Object&&(this.downloadTracker=WP_Statistics_DataPlus_Event_Object.options.downloadTracker,this.linkTracker=WP_Statistics_DataPlus_Event_Object.options.linkTracker,(this.downloadTracker||this.linkTracker)&&this.captureEvent()),window.wp_statistics_event=this.handleCustomEvent.bind(this),"undefined"!=typeof WP_Statistics_Marketing_Event_Object&&this.captureCustomClickEvents())},handleCustomEvent:function(t,e={}){e.timestamp=Date.now(),e.resource_id||(e.resource_id=WP_Statistics_Tracker_Object.hitParams.source_id);const i={event_name:t,event_data:JSON.stringify(e)};if(window.WpStatisticsBatchQueue)WpStatisticsBatchQueue.add("custom_event",i);else{const t=WP_Statistics_Tracker_Object.customEventAjaxUrl;this.sendEventData(i,t)}},captureCustomClickEvents:function(){WP_Statistics_Marketing_Event_Object.events.clicks.forEach(t=>{t.selector&&(null!=t.scope&&t.scope!=WP_Statistics_Tracker_Object.hitParams.source_id||document.querySelectorAll(`${t.selector}`).forEach(e=>{e.addEventListener("click",e=>{const i={text:e.target.textContent,id:e.currentTarget.id,class:e.currentTarget.className,target:e.currentTarget.href};this.handleCustomEvent(t.name,i)})}))})},captureEvent:function(){document.querySelectorAll("a").forEach(t=>{t.addEventListener("click",async t=>await this.handleEvent(t)),t.addEventListener("mouseup",async t=>await this.handleEvent(t))})},handleEvent:async function(t){if("mouseup"==t.type&&1!=t.button)return;const e=this.prepareEventData(t);if(e){const t=WP_Statistics_DataPlus_Event_Object.eventAjaxUrl;await this.sendEventData(e,t)}},prepareEventData:function(t){let e={en:t.type,et:Date.now(),eid:t.currentTarget.id,ec:t.currentTarget.className,ev:"",mb:t.button,fn:"",fx:"",m:"",tu:"",pid:""};return"A"===t.currentTarget.tagName&&(e=this.extractLinkData(t,e)),"undefined"!=typeof WP_Statistics_Tracker_Object&&(e.pid=WP_Statistics_Tracker_Object.hitParams.source_id),e},extractLinkData(t,e){const i=t.target.textContent,n=t.currentTarget.href,s=WP_Statistics_DataPlus_Event_Object.fileExtensions,a=new RegExp("\\.("+s.join("|")+")$","i");i&&(e.ev=i),n&&(e.tu=n);const c=t.currentTarget.classList.contains("woocommerce-MyAccount-downloads-file")||n.includes("download_file=");if(e.wcdl=c,a.test(n)||c){const t=new URL(n).pathname;e.df=c?n.substring(n.lastIndexOf("download_file=")+14).split("&").shift():"",e.dk=c?n.substring(n.lastIndexOf("key=")+4).split("&").shift():"",e.en="file_download",e.fn=c?e.df:t.substring(t.lastIndexOf("/")+1).split(".").shift(),e.fx=c?e.df:t.split(".").pop()}if("click"===e.en){if(!this.linkTracker)return!1;if(n.toLowerCase().includes(window.location.host))return!1}return!("file_download"===e.en&&!this.downloadTracker)&&e},sendEventData:async function(t,e){const i=new URLSearchParams;for(const s in t)i.append(s,t[s]);if(!e)throw new Error("AJAX URL is not defined.");try{(await fetch(e,{method:"POST",keepalive:!0,body:i})).ok}catch(n){console.error("Error:",n)}}}),document.addEventListener("DOMContentLoaded",function(){const t=WP_Statistics_Tracker_Object.option.consentIntegration.name;t||(WpStatisticsUserTracker.init(),WpStatisticsEventTracker.init()),"wp_consent_api"===t&&function(){const t=WP_Statistics_Tracker_Object.option.consentIntegration.status.consent_level,e=WP_Statistics_Tracker_Object.option.consentIntegration.status.track_anonymously;(e||"disabled"==t||wp_has_consent(t))&&(WpStatisticsUserTracker.init(),WpStatisticsEventTracker.init());document.addEventListener("wp_listen_for_consent_change",function(i){const n=i.detail;for(let s in n)n.hasOwnProperty(s)&&s===t&&"allow"===n[s]&&(WpStatisticsUserTracker.init(),WpStatisticsEventTracker.init(),e&&WpStatisticsUserTracker.checkHitRequestConditions())})}(),"real_cookie_banner"===t&&(window.consentApi?.consent("wp-statistics")||Promise.resolve()).then(()=>{WpStatisticsUserTracker.init(),WpStatisticsEventTracker.init()}).catch(()=>{const t=window.consentApi?.consentSync("wp-statistics-with-data-processing");null!=t.cookie&&t.cookieOptIn?(WpStatisticsUserTracker.init(),WpStatisticsEventTracker.init()):console.log("WP Statistics: Real Cookie Banner consent is not given to track visitor information.")})});