name: Notify Pro Repository

on:
  push:
    tags:
      - 'v*'

jobs:
  trigger-pro-build:
    name: Trigger Pro Build
    runs-on: ubuntu-latest

    steps:
      - name: Get Version from Tag
        id: version
        run: |
          VERSION="${GITHUB_REF#refs/tags/}"
          echo "version=$VERSION" >> $GITHUB_OUTPUT
          echo "Triggering Pro build for version: $VERSION"

      - name: Trigger Pro Repository Build
        uses: peter-evans/repository-dispatch@v3
        with:
          token: ${{ secrets.PRO_REPO_PAT }}
          repository: wp-statistics/wp-statistics-pro
          event-type: free-release
          client-payload: '{"version": "${{ steps.version.outputs.version }}"}'

      - name: Log Success
        run: |
          echo "Successfully triggered Pro build for ${{ steps.version.outputs.version }}"
